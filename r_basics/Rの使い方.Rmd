---
title: "R入門"
subtitle: "<small>A tutorial for R</small>"
author: "阿部景太"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: [default,ninjutsu,useR-fonts]
    nature:
      highlightStyle: github
      highlightLines: true
      coutIncrementalSlides: false
      ratio: 16:9
      
---

<style type="text/css">
.remark-slide-content {
    font-size: 30px;
    font-family: "メイリオ" ;
    padding: 1em 4em 1em 4em;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
pacman::p_load(
  tidyverse,
  knitr,
  kableExtra,
  patchwork,
  cols4all
)

options(scipen=999)
```



# R?

- 　**R** は統計、データ分析、作図のためのインタープリタープログラミング言語

- 統計やデータ分析を行うアプリ
  - 他にはSPSS, Stata
  - Pythonもよく使われる

---

# Rのよいところ

- 無料
- 多くにプラットフォーム（MacOS, Windows, Linux)で使用可能
- たくさんの資料がネット上に存在する
- 分析結果をプレゼンテーションするツールが充実している
 - Rstudio: 統合開発環境(IDE)
 - Shiny: 相互的な作図などができるアプリ [例](https://keita43a.shinyapps.io/easter_island/)
- 豊富なパッケージ
  - 多くのエンジニアや研究者が公開

---

# Rの欠点

- Rは進化が早い
- 遅い
  - 一般的なデータ分析をするのには問題がない
  - ビッグデータや複雑な統計モデルを走らせると、遅かったりメモリ消費が激しい
- CUIなので、最初の学習が難しい
  
---

# CUIとGUI

- CUI: Character User Interface
  - 命令を文字で行う（キーボードを使う）操作環境

- GUI: Graphic User Interface
  - マウスでクリックしながら使う操作環境

---

# GUIの方が楽？

- GUIの方が楽では？
  - マウスで操作ができる方がよさそう？

--

- CUIは記録ができる
  - 何度も同じ操作を覚えている
  - 人が書いた一連の操作（コード）をコピー・参考にできる
  - 柔軟性が高い

---

# 統合開発環境 IDE

- IDE: Integrated Development Environment
  - ソフトウェア開発や、データ分析のプロセスをワンストップで行える環境
 - 一部GUIを導入したり、CUIによる操作をアシストする
- 特に強い好みがない限り、**Rstudio**をおすすめ

---

# RとRstudioのインストール

- 学校のパソコンにはすでにインストールされている
- 自分のパソコンに導入したい人は[このスライド](https://speakerdeck.com/s_uryu/introduction-to-r)か[ここ](https://yukiyanai.github.io/jp/resources/)にある「RとRStudioのインストール方法の解説」を参照

---

# コンピュータのディレクトリ構造

```{r  label = directory, echo = FALSE, fig.cap = "ディレクトリ構造", out.width = '90%'}
knitr::include_graphics("fig/directory_structure.png")
```

---

# ゼミフォルダ

ゼミフォルダを作る

- 自分の学生番号のドライブ(例 s1234567)の下に abezemi フォルダを作成

---

# 作業スペース

コンピューター上では、どこかのディレクトリ（フォルダ）が作業場所になっている。
今の作業場所は`getwd()`で表示できる。

```{r, eval=FALSE}
getwd()
```

これを変更するには`setwd(path)`で変更できる

```{r,eval=FALSE}
setwd("j:/abezemi/r_renshu")
```

もう一度`getwd()`すると変更されているはず

---

# プロジェクトの作成

作業場所を指定しても、ファイルの管理が面倒だったりする。

RStudioのRプロジェクトという機能を使うと、以下のメリットがある

- データやスクリプト（コード）へのアクセスが容易
- Git によるバージョン管理のベースにもなる
- 異なる環境でも同じ作業スペースが設定される

---

# Rプロジェクトの作成

- File -> "New Project"
  -もしくは右上の "Project (none)"

- New Directoryでプロジェクトを作成

- "New Project"を選択

- プロジェクト名を入力: r_renshu 
 - 英語で。日本語は使えない（もしくはトラブルの元になる）

---

# スクリプトの作成

Rとの"対話"は、Rstudioの左下の区画(Console)で行われる。
そのままConsoleに入力しても機能するが、**スクリプト**に書くことで、
記録を残しながらRに命令を与えることができる。

**作成**
- File -> New File -> R script
- もしくは左上の区画の白い資格に緑の＋マークのところから、R Script

**保存**
- File -> Save
- フロッピーのアイコン


---

# 実行してみる

R scriptに以下のように書く

```{r}
print("Hello World!")
```

カーソルが同じ行にあることを確認して、Runをクリック
もしくは、Ctrlを押しながらEnter

"Hello World!"と表示されれば成功。

---

# スクリプトの書く際の注意点

R script上では\#から始まる行は、コメントとして認識され、実行するとコンソールには表示されるが、何も起こらない。メモなどを書く際に使う。

```{r}
# これは初めてのRのコードです。
print("Hello World")
```

もしくは一度使ったが、今は実行したくないコードを一時的に向こうにする（コメントアウト）

```{r}
# print("Good Evening")
```


---

# 計算機としてのR

```{r, echo =TRUE}
# 足し算
1 + 1
```

```{r, echo =TRUE}
#掛け算は * 
2 * 3
```

---

# 計算機としてのR

```{r, echo =TRUE}
# 割り算は /
(2+7)/3
```

```{r, echo =TRUE}
# 割り切れない場合はある程度まで桁が表示
10/3
```

---

# 論理演算

書いてあることが真か偽か？

```{r}
# 「10は5より大きい」という命題は正しい？
10 > 5
```

```{r}
# 「等しい」は=が2つ == 
"musashi" == "musashi"
```

```{r}
"musashi" == "634"
```


---

# 変数へのオブジェクトの代入

```{r}
# x や yという「入れ物」に数字を代入
x <- 8
y <- 3

z <- x + y
z
```

---

# データ型

Rのオブジェクトにはいくつかの「型」がある

```{r}
# 実数
x <- 8
mode(x)
```

```{r}
# 文字列
y <- "musashi"
mode(y)
```

---

# データ型：注意点

数字であっても文字列として扱われていると、計算ができない

```{r}
# 数字だが文字列
z <- "5"
mode(z)
```

```{r, error = TRUE}
z + 6
```

---

# データ型の変換

```{r}
# データ型のチェック
mode(z)
# 実数かどうか？
is.numeric(z)
```

```{r}
# データ型を実数に変換して再度zに代入
z <- as.numeric(z)
# 再度チェック
is.numeric(z)
```

---

# ベクトル

順序のある要素の集まりをベクトルと呼ぶ。
`c()`関数で作成することができる。

```{r}
v1 <- c(1,2,3,4,5)
v1
```

ベクトルは、文字や論理値など取ることができる。

```{r}
v2 <- c("musashi","nerima","ekoda")
v2
```

```{r}
v3 <- c(FALSE,TRUE,TRUE,FALSE)
v3
```


---

# ベクトルの型

異なるデータ型を同じベクトルに混ぜることはできない。
混ぜると、一定のルールに基づいてある型が他の型より優先される


```{r}
# 数値と論理値を混ぜると、数値になる。(FALSE->0, TRUE->1)
v4 <- c(FALSE,1,TRUE)
v4 
```

```{r}
# 数値と論理値と文字列を混ぜると、全部文字列になる

v5 <- c(FALSE,1,"musashi")
v5
```

---

# ベクトル：連続した数値

連続した数値を入力したい場合はコロン`:`を使う

```{r}
v6 <- c(1:10)
v6
```

nずつ増える数列を作りたい場合は、`seq()`関数を使う

```{r}
# 例：2から50まで２ずつ増える数列
v7 <- seq(2,50,by=2)
```

**練習問題**：3から60まで3ずつ増える数列ベクトルを作りなさい

---

# ベクトル：連続した数値

同じ数値がたくさんあるベクトルを作りたい場合は`rep()`関数を使う

```{r}
# 5が100個ならぶベクトル
v8 <- rep(5,100)
v8
```

本当に100個出てるか？
ベクトルの要素の数を数える関数は`length`

```{r}
length(v8)
```

---

# 参照

ベクトルのn個目の要素を参照したいときは角カッコを使う`[]`

```{r}
# v7の3つ目の要素は6
v7[3]
```

```{r}
# v7の2,3,5つ目の要素
v7[c(2,3,5)]
```

---

# リスト

様々なベクトルやデータなどのオブジェクトをひとまとめにして扱うことができるのがリスト
リストは`list()`関数で作成する

```{r}
# ここでは、カンマ, の後に改行しているが、listのかっこが閉じるまではひとまとまりだと扱われる。

a <- list(
  c("a", "b", NA, "d"),
  num = c(3, 1.1, 5),
  data = head(mtcars, 1))

a
```

---

# リストの参照

リストの参照も角カッコでできる
```{r}
# リストの参照
a[1]
a[2]
```

---

# リストの参照

リストの中身のみを取り出したい場合は、二重括角カッコを使う`[[]]`

```{r}
a[[3]]
```

---

# データフレーム

Rではデータをデータフレームという形で扱う
例として、Rに入っているmtcarsというデータを見てみよう

```{r}
data1 <- mtcars
```



---

# データを見てみる

右上のEnvironment区画にdata1というオブジェクトが生成される
クリックしてみると、エクセルのような画面が現れる

また`View()`という関数をつかっても、同じようにデータを見ることができる。

```{r eval=FALSE}
View(data1)
```
---

# データを見てみる

また、データの最初だけみたいときは、`head()`, また後ろだけ見たいときは`tail()`関数を使う。
デフォルトでは、6行だけ表示されるが、行数は引数nで調整できる。

```{r}
head(data1, n=10)
```

